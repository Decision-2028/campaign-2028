<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Trail 2028</title>
    <style>
        /* --- CSS STYLES --- */
        :root { --bg: #121214; --panel: #1e1e24; --text: #fff; --blue: #00AEF3; --red: #E81B23; --gold: #F2C75C; --green: #4caf50; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; text-align: center; }
        
        /* LAYOUT */
        .screen { display: none; max-width: 1000px; margin: 0 auto; animation: fadeIn 0.5s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* HEADER & HUD */
        .dashboard-hud { display: flex; justify-content: space-between; background: #000; padding: 15px; border-bottom: 1px solid #333; margin-bottom: 20px; border-radius: 8px; }
        .hud-item span { display: block; }
        .hud-label { font-size: 0.7rem; color: #888; }
        .hud-value { font-size: 1.2rem; font-weight: bold; }

        /* MAP AREA */
        .map-wrapper { 
            position: relative; 
            background: #2b303b; 
            border: 2px solid #444; 
            border-radius: 8px; 
            height: 600px; 
            overflow: hidden; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        svg { width: 100%; height: 100%; display: block; }
        /* Map Interaction Styles */
        path { fill: #ccc; stroke: #fff; stroke-width: 0.5px; transition: 0.2s; cursor: pointer; }
        path:hover { opacity: 0.8; stroke-width: 2px; stroke: #fff; }

        /* CONTROLS */
        .controls-area { background: var(--panel); padding: 15px; border-radius: 8px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .legend { display: flex; gap: 10px; font-size: 0.9rem; }
        .dot { width: 12px; height: 12px; display: inline-block; border-radius: 50%; }
        
        /* COLORS */
        .safe-d { background: #003f5c; } .lean-d { background: #58508d; }
        .tossup { background: #ccc; }
        .lean-r { background: #ff6361; } .safe-r { background: #bc5090; }

        /* CARDS & BUTTONS */
        .primary-btn { background: #fff; border: none; padding: 15px 30px; font-size: 1.2rem; font-weight: bold; cursor: pointer; border-radius: 4px; margin-top: 20px; }
        .action-btn { background: var(--green); color: white; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .action-btn:disabled { background: #555; cursor: not-allowed; }
        
        .grid-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: var(--panel); padding: 15px; border: 1px solid #333; border-radius: 6px; cursor: pointer; text-align: left; display: flex; gap: 10px; align-items: center; }
        .card:hover { border-color: #fff; background: #2a2a2a; }
        .card img { width: 60px; height: 60px; object-fit: cover; background: #000; }

        /* TOOLTIP */
        .tooltip { position: absolute; background: rgba(0,0,0,0.9); padding: 8px; border-radius: 4px; pointer-events: none; display: none; z-index: 100; border: 1px solid #555; }
    </style>
</head>
<body>

    <div id="screen-intro" class="screen active">
        <h1>THE CAMPAIGN TRAIL 2028</h1>
        <p>The nation is divided. Can you win 270 Electoral Votes?</p>
        <button class="primary-btn" onclick="game.setScreen('screen-party')">START CAMPAIGN</button>
    </div>

    <div id="screen-party" class="screen">
        <h2>SELECT PARTY</h2>
        <div class="grid-list" style="justify-content: center;">
            <div class="card" onclick="game.selectParty('D')" style="border-left: 5px solid var(--blue)"><h3>DEMOCRATS</h3></div>
            <div class="card" onclick="game.selectParty('R')" style="border-left: 5px solid var(--red)"><h3>REPUBLICANS</h3></div>
            <div class="card" onclick="game.selectParty('I')" style="border-left: 5px solid var(--gold)"><h3>INDEPENDENT</h3></div>
        </div>
    </div>

    <div id="screen-candidate" class="screen">
        <h2 id="party-title">Select Candidate</h2>
        <div id="candidate-list" class="grid-list"></div>
    </div>

    <div id="screen-vp" class="screen">
        <h2>Select Running Mate</h2>
        <div id="vp-list" class="grid-list"></div>
    </div>

    <div id="screen-map" class="screen">
        <header class="dashboard-hud">
            <div class="hud-item"><span class="hud-label">CANDIDATE</span><span id="hud-candidate" class="hud-value">...</span></div>
            <div class="hud-item"><span class="hud-label">ELECTORAL VOTES</span><span id="hud-ev" class="hud-value">0 / 270</span></div>
            <div class="hud-item"><span class="hud-label">WEEKS LEFT</span><span id="hud-turn" class="hud-value">12</span></div>
            <div class="hud-item"><span class="hud-label">FUNDS</span><span id="hud-funds" class="hud-value">$0</span></div>
        </header>

        <div class="map-wrapper">
            <div id="map-container" style="width:100%; height:100%;">Loading map.svg...</div>
            <div id="tooltip" class="tooltip"></div>
        </div>

        <div class="controls-area">
            <div class="legend">
                <div><span class="dot safe-d"></span> Safe D</div>
                <div><span class="dot lean-d"></span> Lean D</div>
                <div><span class="dot tossup"></span> Tossup</div>
                <div><span class="dot lean-r"></span> Lean R</div>
                <div><span class="dot safe-r"></span> Safe R</div>
            </div>
            <div>
                <h3 id="state-name" style="margin:0">Select State</h3>
                <div id="state-poll" style="font-size:0.9rem; margin-bottom:5px;">--</div>
                <button id="btn-campaign" class="action-btn" disabled onclick="game.campaign()">CAMPAIGN ($100k)</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const DATA = {
            D: { name: "Democrats", color: "#00AEF3", list: [
                {id:"newsom", name:"Gavin Newsom", home:"CA", img:"images/newsom.jpg"},
                {id:"harris", name:"Kamala Harris", home:"CA", img:"images/harris.jpg"},
                {id:"whitmer", name:"Gretchen Whitmer", home:"MI", img:"images/whitmer.jpg"}
            ]},
            R: { name: "Republicans", color: "#E81B23", list: [
                {id:"vance", name:"JD Vance", home:"OH", img:"images/vance.jpg"},
                {id:"desantis", name:"Ron DeSantis", home:"FL", img:"images/desantis.jpg"},
                {id:"haley", name:"Nikki Haley", home:"SC", img:"images/haley.jpg"}
            ]},
            I: { name: "Independents", color: "#F2C75C", list: [
                {id:"yang", name:"Andrew Yang", home:"NY", img:"images/yang.jpg"}
            ]}
        };

        const STATES = {
            "AL":{ev:9, p:35}, "AK":{ev:3, p:42}, "AZ":{ev:11, p:49}, "AR":{ev:6, p:35}, "CA":{ev:54, p:65},
            "CO":{ev:10, p:56}, "CT":{ev:7, p:59}, "DE":{ev:3, p:60}, "DC":{ev:3, p:90}, "FL":{ev:30, p:45},
            "GA":{ev:16, p:48}, "HI":{ev:4, p:68}, "ID":{ev:4, p:30}, "IL":{ev:19, p:57}, "IN":{ev:11, p:40},
            "IA":{ev:6, p:43}, "KS":{ev:6, p:40}, "KY":{ev:8, p:35}, "LA":{ev:8, p:38}, "ME":{ev:4, p:55},
            "MD":{ev:10, p:63}, "MA":{ev:11, p:65}, "MI":{ev:15, p:51}, "MN":{ev:10, p:53}, "MS":{ev:6, p:38},
            "MO":{ev:10, p:41}, "MT":{ev:4, p:40}, "NE":{ev:5, p:38}, "NV":{ev:6, p:50}, "NH":{ev:4, p:52},
            "NJ":{ev:14, p:58}, "NM":{ev:5, p:54}, "NY":{ev:28, p:60}, "NC":{ev:16, p:48}, "ND":{ev:3, p:30},
            "OH":{ev:17, p:45}, "OK":{ev:7, p:32}, "OR":{ev:8, p:58}, "PA":{ev:19, p:50}, "RI":{ev:4, p:60},
            "SC":{ev:9, p:42}, "SD":{ev:3, p:35}, "TN":{ev:11, p:37}, "TX":{ev:40, p:43}, "UT":{ev:6, p:38},
            "VT":{ev:3, p:65}, "VA":{ev:13, p:54}, "WA":{ev:12, p:60}, "WV":{ev:4, p:28}, "WI":{ev:10, p:50},
            "WY":{ev:3, p:25}
        };

        // --- GAME ENGINE ---
        const game = {
            party: null, player: null, vp: null, funds: 2000000, week: 1, maxWeeks: 12,
            states: JSON.parse(JSON.stringify(STATES)),
            selState: null,

            setScreen(id) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            },

            selectParty(p) {
                this.party = p;
                const d = DATA[p];
                document.getElementById('party-title').innerText = d.name;
                document.getElementById('party-title').style.color = d.color;
                
                const list = document.getElementById('candidate-list');
                list.innerHTML = '';
                d.list.forEach(c => {
                    list.innerHTML += `<div class="card" onclick="game.selectCandidate('${c.id}')">
                        <img src="${c.img}" onerror="this.src='https://via.placeholder.com/60'">
                        <div><h3>${c.name}</h3><small>${c.home}</small></div>
                    </div>`;
                });
                this.setScreen('screen-candidate');
            },

            selectCandidate(id) {
                this.player = DATA[this.party].list.find(x => x.id === id);
                // VP Logic
                const list = document.getElementById('vp-list');
                list.innerHTML = '';
                DATA[this.party].list.filter(x => x.id !== id).forEach(c => {
                    list.innerHTML += `<div class="card" onclick="game.startGame('${c.id}')">
                        <img src="${c.img}" onerror="this.src='https://via.placeholder.com/60'">
                        <div><h3>${c.name}</h3><small>Boosts ${c.home}</small></div>
                    </div>`;
                });
                this.setScreen('screen-vp');
            },

            async startGame(vpId) {
                this.vp = DATA[this.party].list.find(x => x.id === vpId);
                
                // Apply Bonuses
                if(this.party === 'D') {
                    if(this.states[this.player.home]) this.states[this.player.home].p += 10;
                    if(this.states[this.vp.home]) this.states[this.vp.home].p += 5;
                } else {
                    if(this.states[this.player.home]) this.states[this.player.home].p -= 10;
                    if(this.states[this.vp.home]) this.states[this.vp.home].p -= 5;
                }

                this.setScreen('screen-map');
                this.updateHUD();
                await this.loadMap();
            },

            async loadMap() {
                const con = document.getElementById('map-container');
                try {
                    const res = await fetch('map.svg');
                    if(!res.ok) throw new Error("map.svg not found");
                    con.innerHTML = await res.text();
                    
                    // FIX: The SVG uses classes (.tx) but we need to link them to our data (TX)
                    setTimeout(() => {
                        const svg = con.querySelector('svg');
                        Object.keys(this.states).forEach(code => {
                            // Find path by class (lowercase)
                            const path = svg.querySelector(`.${code.toLowerCase()}`);
                            if(path) {
                                path.id = code; // Assign ID for easier access
                                path.onclick = () => this.clickState(code);
                                path.onmouseenter = (e) => this.showTip(e, code);
                                path.onmouseleave = () => document.getElementById('tooltip').style.display = 'none';
                            }
                        });
                        this.colorMap();
                    }, 100);
                } catch(e) {
                    con.innerHTML = `<h3 style="color:red; margin-top:50px">Error: map.svg not found.<br>Upload map.svg to your repo!</h3>`;
                }
            },

            colorMap() {
                Object.keys(this.states).forEach(code => {
                    const el = document.getElementById(code);
                    if(!el) return;
                    const p = this.states[code].p;
                    let c = "#ccc";
                    if(p >= 60) c = "#003f5c";
                    else if(p >= 54) c = "#00AEF3";
                    else if(p >= 51) c = "#58508d";
                    else if(p <= 40) c = "#bc5090";
                    else if(p <= 46) c = "#E81B23";
                    else if(p <= 49) c = "#ff6361";
                    el.style.fill = c;
                });
            },

            clickState(code) {
                this.selState = code;
                const s = this.states[code];
                document.getElementById('state-name').innerText = `${code} (${s.ev} EV)`;
                document.getElementById('state-poll').innerText = `Poll: ${s.p.toFixed(1)}% Dem`;
                
                const btn = document.getElementById('btn-campaign');
                btn.disabled = false;
                btn.innerText = `CAMPAIGN IN ${code}`;
            },

            campaign() {
                if(this.funds < 100000) return alert("No money!");
                this.funds -= 100000;
                
                const s = this.states[this.selState];
                const boost = Math.random() * 2 + 0.5;
                if(this.party === 'D') s.p += boost; else s.p -= boost;
                
                this.week++;
                if(this.week > 12) this.endGame();
                
                this.updateHUD();
                this.colorMap();
                this.clickState(this.selState);
            },

            updateHUD() {
                document.getElementById('hud-candidate').innerText = this.player.name;
                document.getElementById('hud-funds').innerText = `$${(this.funds/1000000).toFixed(1)}M`;
                document.getElementById('hud-turn').innerText = 12 - this.week;
                
                let dev = 0, rev = 0;
                Object.values(this.states).forEach(s => {
                    if(s.p >= 50) dev += s.ev; else rev += s.ev;
                });
                document.getElementById('hud-ev').innerText = `${this.party==='D'?dev:rev} / 270`;
            },

            showTip(e, code) {
                const t = document.getElementById('tooltip');
                const s = this.states[code];
                t.style.display = 'block';
                t.style.left = e.pageX + 15 + 'px';
                t.style.top = e.pageY + 15 + 'px';
                t.innerHTML = `<strong>${code}</strong><br>${s.p.toFixed(1)}% Dem`;
            },

            endGame() {
                alert("Election Over! Check EV count.");
                location.reload();
            }
        };
    </script>
</body>
</html>
